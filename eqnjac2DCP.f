	subroutine eqnjac2DCP(n,t,x,yprime,df)
      integer n,l
      double precision B,F,E,alpha,yprime(2*n),
     :J(n,n),x(2*n),sum,t,df,yyp(n),
     :c1,c2,c3,c4,c5,c6,c7,u1,u2,u3,pi,g
	  parameter (pi=3.141592653589795) 
      external impampl
c
      call impampl(F,B,E,alpha) 
	  c1=x(1)**2+x(2)**2   
	  c2=x(1)*x(5)-x(2)*x(4)
	  c3=x(1)**2-x(2)**2 
	  c4=x(1)*x(2)
c	g=dmod(x(3),2*pi) 
	  c5=dcos(x(3))
	  c6=dsin(x(3)) 
	  c7=c5**2-c6**2
	  u1=1+0.5*B
	  u2=0.5*u1*c1
	  u3=(alpha-1)*F
 
      J(1,1)=u1*c4
      J(1,2)=0.5*u1*(x(1)**2+3*x(2)**2)
      J(1,3)=0.
      J(1,4)=1.
      J(1,5)=0.
      J(1,6)=0.
      J(2,1)=-0.5*u1*(3*x(1)**2+x(2)**2)
      J(2,2)=-J(1,1)
      J(2,3)=0.
      J(2,4)=0.
      J(2,5)=1.
      J(2,6)=0.
      J(3,1)=2*x(1)
      J(3,2)=2*x(2)
      J(3,3)=0.
      J(3,4)=0.
      J(3,5)=0.
      J(3,6)=0.
      J(4,1)=-(2*x(6)-u1*(2*x(1)*x(5)-x(2)*x(4))-
     :u1*x(1)*x(5)+6*F*x(1)**2+
     :24./32.*B**2*x(1)**2*c1+6./32.*B**2*c1**2
     :+2*u3*(1/2*(3*x(1)**2-x(2)**2)*c6
     :+2*x(1)*x(2)*c5)*c6+u3*2
     :*x(1)*(x(1)*c6+x(2)*c5)*c6+u3*c1*c6**2)
c    
      J(4,3)=-(2*u3*x(1)*(c3*c6
     :*c5+x(1)*x(2)*c7)+u3*
     :c1*(2*x(1)*c6*c5+x(2)*c7))
      J(4,2)=-(u1*x(1)*x(4)-u1*x(2)*x(5)+
     :24./32.*B**2*c4*c1
     :+2*u3*x(1)*(-x(2)*c6
     :+x(1)*c5)*c6+2*u3*
     :x(2)*(x(1)*c6+x(2)*c5)*c6+u3*c1*c5*c6)
      J(4,4)=-J(1,1)
      J(4,5)=-(-u1*x(1)**2-u2)
      J(4,6)=-2*x(1)
      J(5,1)=-(-u1*x(2)*x(5)+u1*x(1)*x(4)+
     :24./32.*B**2*c4*c1
     :+2*u3*x(2)*(x(1)*c6
     :+x(2)*c5)*c6+2*u3*
     :x(1)*(-x(2)*c6+x(1)*
     :c5)*c6+u3*c1*c5*c6)
      J(5,2)=-(2*x(6)-u1*(x(1)*x(5)-2*x(2)*x(4))+
     :u1*x(2)*x(4)-6.*F*x(2)**2+
     :6./32.*B**2*c1**2+24./32.*B**2*x(2)**2*c1
     :+2*u3*(1/2*(x(1)**2-3*x(2)**2)*
     :c6+2*c4*c5)*c6+
     :2*u3*x(2)*(-x(2)*c6+x(1)*c5)*c6-u3*c1*(c6)**2)
      J(5,3)=-(2*u3*x(2)*(c3*c6
     :*c5+x(1)*x(2)*c7)+u3*c1*(-2*x(2)*
     :c6*c5+x(1)*c7))
      J(5,4)=-(u1*x(2)**2+u2)
      J(5,6)=-2*x(2)
      J(5,5)=J(1,1)
      J(6,1)=-u3*2*x(1)*(c3*c6*c5+x(1)*x(2)*
     :c7)-u3*c1*(2*x(1)*c6*c5+x(2)*c7)
      J(6,2)=-2*u3*x(2)*(c3*c6*c5+x(1)*x(2)*c7)-u3*c1*(-2*x(2)*c6*
     :c5+x(1)*c7)
      J(6,3)=-(u3*c1*(c3*c7-4*c4*c5*c6))
      J(6,4)=0.
      J(6,5)=0.
      J(6,6)=0.
      yprime(1)=x(4)+u2*x(2)
      yprime(2)=x(5)-u2*x(1)
      yprime(3)=c1
      yprime(4)=-(2*x(6)*x(1)-u1*x(1)*
     :c2-u2*x(5)+2*F*x(1)**3+6./32.*B**2*x(1)*c1**2
     :+u3*c6*(x(1)*(c3*c6+2*c4*c5)+c1*(x(1)*c6+x(2)*c5)))
	  yprime(5)=-(2*x(2)*x(6)-u1*x(2)*c2
     :+u2*x(4)-2.*F*x(2)**3+
     :6./32.*B**2*x(2)*c1**2
     :+u3*c6*(x(2)*(c3*c6+2*c4*c5)+c1*(-x(2)*c6+x(1)*c5)))
      yprime(6)=-u3*c1*(0.5*c3*dsin(2*x(3))+c4*dcos(2*x(3)))   
  
      do 15, l=1,6
      sum=J(l,1)*x(7)
      do 16, i=2,6
      sum=sum+J(l,i)*x(i+6)   
   16 continue
      yprime(l+6)=sum
      yyp(l)=yprime(l+6)
   15 continue
      call norm(yyp,6,df)
	  do 453, l=1,6
	  yprime(l+6)=yprime(l+6)
 453  continue
      return
      end subroutine
